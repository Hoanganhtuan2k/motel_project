<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Trang chủ</title>
    <link rel="stylesheet" th:href="@{/webjars/font-awesome/6.7.2/css/all.min.css}"/>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/4.5.2/css/bootstrap.min.css}"/>
    <link rel="stylesheet" href="/styles/home_page.css">
</head>

<body>

<div th:replace="~{parts/header :: header}"></div>

<div class="topnav" th:fragment="navigation">
    <!-- Home luôn hiển thị khi đăng nhập -->
    <a class="active" href="/">Home</a>

    <a href="/motels" sec:authorize="hasRole('ADMIN')">Motels</a>
    <a href="/posts/create/motel" sec:authorize="hasRole('ADMIN')">Posts</a>

    <div class="dropdown" style="float: right;height: 170px" sec:authorize="isAuthenticated()">
        <a class="dropdown-toggle" href="#" role="button" id="userDropdown"
           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
           style="padding: 14px; color: #007bff; text-decoration: none;">
            <i class="fas fa-user" style="font-size: 20px;"></i>
        </a>

        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
            <a class="dropdown-item" href="/profile">Thông tin cá nhân</a>
            <form th:action="@{/logout}" method="post" style="margin: 0;">
                <button type="submit" class="dropdown-item">Đăng xuất</button>
            </form>
        </div>

    </div>

    <!-- Chưa đăng nhập -->
    <div style="float: right;" sec:authorize="isAnonymous()">
        <a href="/auth/login">Đăng nhập</a>
        <a href="/auth/register">Đăng ký</a>
    </div>
</div>

<div class="home-container">
    <h1>Trang chủ cho thuê nhà trọ</h1>
    <h2>Dễ dàng tìm kiếm phòng trọ phù hợp</h2>

    <section id="posts">
        <h2>Danh sách bài viết</h2>

        <form th:action="@{/}" method="get" class="search-form">
            <input type="text" name="keyword" th:value="${keyword}" placeholder="Tìm theo tiêu đề...">
            <button type="submit">Tìm kiếm</button>
        </form>

        <div class="post-grid">
            <div th:each="post : ${posts}" class="post-card">
                <h4 th:text="${post.title}">[Tên nhà trọ]</h4>
                <p><strong>Nội dung:</strong> <span th:text="${post.content}">[Nội dung]</span></p>

                <div sec:authorize="isAuthenticated()">
                    <p><strong>Người đăng:</strong> <span th:text="${post.adminId}">[Người đăng]</span></p>
                    <p th:if="${post.relatedRoomId != null}">
                        <strong>Phòng liên quan:</strong> <span th:text="${post.relatedRoomId}">[Mã phòng]</span>
                    </p>
                    <p><strong>Trạng thái:</strong> <span th:text="${post.status}">[Trạng thái]</span></p>
                    <p><strong>Cập nhật:</strong> <span th:text="${#temporals.format(post.updatedAt, 'dd/MM/yyyy HH:mm')}">[Ngày cập nhật]</span></p>
                </div>

                <p><strong>Ngày đăng:</strong> <span th:text="${#temporals.format(post.createdAt, 'dd/MM/yyyy HH:mm')}">[Ngày đăng]</span></p>

                <div class="post-actions" sec:authorize="isAuthenticated()">
                    <a th:href="@{'/posts/' + ${post.id}}" class="btn btn-detail"><i class="fas fa-eye"></i> Xem</a>
                    <a th:href="@{'/posts/edit/' + ${post.id}}" class="btn btn-edit"><i class="fas fa-pen"></i> Sửa</a>
                    <a th:href="@{'/posts/delete/' + ${post.id}}" class="btn btn-delete" onclick="return confirm('Bạn có chắc muốn xóa bài này?');"><i class="fas fa-trash-alt"></i> Xóa</a>
                    <a th:href="@{'/contracts/create/' + ${post.id}}" class="btn btn-rent" target="_blank"><i class="fas fa-file-contract"></i> Thuê</a>
                    <a th:href="@{'/comments/' + ${post.id}}" class="btn btn-comment"><i class="fas fa-comment-dots"></i> Comment</a>
                </div>
            </div>
        </div>
    </section>


    <div class="pagination-container" th:if="${totalPages >= 1}">
        <a class="pagination-link"
           th:classappend="${currentPage > 1} ? '' : 'disabled'"
           th:href="@{/(page=${currentPage - 1}, keyword=${keyword})}"
           th:attr="disabled=${currentPage == 1}">&laquo; Trước</a>

        <span th:each="page : ${#numbers.sequence(1, totalPages)}">
        <a class="pagination-link"
           th:href="@{/(page=${page}, keyword=${keyword})}"
           th:text="${page}"
           th:classappend="${page == currentPage} ? ' active-page' : ''"></a>
    </span>

        <a class="pagination-link"
           th:classappend="${currentPage < totalPages} ? '' : 'disabled'"
           th:href="@{/(page=${currentPage + 1}, keyword=${keyword})}"
           th:attr="disabled=${currentPage == totalPages}">Tiếp &raquo;</a>
    </div>
</div>

<section id="auth" sec:authorize="isAnonymous()">
    <p>Bạn muốn đăng bài? Vui lòng đăng nhập!</p>
    <a href="/login">Đăng nhập</a>
    <p>Nếu chưa có tài khoản, vui lòng <a href="/registration">Đăng ký</a>.</p>
</section>

<div th:insert="~{parts/footer :: footer}"></div>

<script th:src="@{/webjars/jquery/3.5.1/jquery.min.js}"></script>
<script th:src="@{/webjars/bootstrap/4.5.2/js/bootstrap.bundle.min.js}"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll(".topnav a");
        const currentPath = window.location.pathname;
        console.log(currentPath);
        navLinks.forEach(link => {
            if (link.getAttribute("href") === currentPath) {
                link.classList.add("active");
            } else {
                link.classList.remove("active");
            }
        });
    });
</script>

</body>
</html>
